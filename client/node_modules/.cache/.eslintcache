[{"C:\\Users\\win\\Desktop\\seawars-react\\client\\src\\index.js":"1","C:\\Users\\win\\Desktop\\seawars-react\\client\\src\\App.js":"2"},{"size":153,"mtime":1649182783646,"results":"3","hashOfConfig":"4"},{"size":18791,"mtime":1651077429091,"results":"5","hashOfConfig":"4"},{"filePath":"6","messages":"7","suppressedMessages":"8","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"1jylp8x",{"filePath":"9","messages":"10","suppressedMessages":"11","errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"12"},"C:\\Users\\win\\Desktop\\seawars-react\\client\\src\\index.js",[],[],"C:\\Users\\win\\Desktop\\seawars-react\\client\\src\\App.js",["13","14","15","16"],[],"import React from \"react\";\nimport io from \"socket.io-client\";\n\nconst socket = io.connect(\"http://localhost:3001\");\n\nconst gridSize = 30;\n\nconst grid = [];\nfor (let i = 0; i < 10; i++) grid.push(Array.from(Array(10), () => 0));\n\nconst enemyGridRefs = [];\nfor (let i = 0; i < 10; i++)\n  enemyGridRefs.push(Array.from(Array(10), () => React.createRef()));\n\nconst allyGridRefs = [];\nfor (let i = 0; i < 10; i++)\n  allyGridRefs.push(Array.from(Array(10), () => React.createRef()));\n\nconst gridContent = [];\nfor (let i = 0; i < 10; i++) gridContent.push(Array.from(Array(10), () => \"\"));\n\nconst gridContentEnemy = [];\nfor (let i = 0; i < 10; i++)\n  gridContentEnemy.push(Array.from(Array(10), () => \"\"));\n\nconst neighborsMoves = [\n  [0, -1],\n  [-1, -1],\n  [-1, 0],\n  [-1, 1],\n  [0, 1],\n  [1, 1],\n  [1, 0],\n  [1, -1],\n];\n\nfunction errorHandle(shipsObjRefCurrent) {\n  shipsObjRefCurrent.style.borderColor = \"red\";\n  setTimeout(() => (shipsObjRefCurrent.style.borderColor = \"blue\"), 500);\n  return false;\n}\n\nfunction multidimensionalIncludes(multidimensionalArray, searchArray) {\n  return multidimensionalArray.some(\n    (row) => JSON.stringify(row) === JSON.stringify(searchArray)\n  );\n}\n\nfunction deepListCopy(l) {\n  return JSON.parse(JSON.stringify(l));\n}\n\nexport default function SeaWars() {\n  const [hitCounter, setHitCounter] = React.useState(0);\n  const [username, setUsername] = React.useState(\"\");\n  const [roomID, setRoomID] = React.useState(\"\");\n  const [gridContentState, setGridContentState] = React.useState(gridContent);\n  const [turn, setTurn] = React.useState(false);\n  const [gridContentEnemyState, setGridContentEnemyState] =\n    React.useState(gridContentEnemy);\n\n  const [fieldReady, setFieldReady] = React.useState(false);\n  const [showField, setShowField] = React.useState(false);\n\n  function joinRoom() {\n    if (username && roomID) {\n      socket.emit(\"join_room\", roomID);\n    }\n  }\n\n  React.useEffect(() => {\n    socket.on(\"hit_back\", (data) => {\n      console.log(\"hit back\");\n      setGridContentState((prev) => {\n        const gridContentStateCopy = deepListCopy(prev);\n        if (grid[data.row][data.col]) {\n          gridContentStateCopy[data.row][data.col] = \"╳\";\n          const hit_result_data = {\n            row: data.row,\n            col: data.col,\n            mark: \"╳\",\n          };\n          socket.emit(\"hit_result\", hit_result_data);\n        } else {\n          const hit_result_data = {\n            row: data.row,\n            col: data.col,\n            mark: \"○\",\n          };\n          socket.emit(\"hit_result\", hit_result_data);\n          gridContentStateCopy[data.row][data.col] = \"○\";\n        }\n        return gridContentStateCopy;\n      });\n    });\n    socket.on(\"hit_result_back\", (data) => {\n      console.log(\"hit_result_back\");\n      setGridContentEnemyState((prev) => {\n        const gridContentEnemyStateCopy = deepListCopy(prev);\n        gridContentEnemyStateCopy[data.row][data.col] = data.mark;\n        return gridContentEnemyStateCopy;\n      });\n      socket.emit(\"change_turn\", true);\n    });\n    socket.on(\"win\", () => {\n      setTimeout(() => document.location.reload(), 3000);\n      alert(\"you win!\");\n    });\n    socket.on(\"lose\", () => {\n      setTimeout(() => document.location.reload(), 3000);\n      alert(\"you lose :(\");\n    });\n    socket.on(\"change_turn_back\", (isTurn) => {\n      setTurn(isTurn);\n    });\n    socket.on(\"set_turn\", (isTurn) => {\n      setTurn(true);\n    });\n    socket.on(\"success_join\", (data) => {\n      setShowField(true);\n    });\n    socket.on(\"failed_join\", (data) => {\n      alert(\"failed to join, room is full\");\n    });\n  }, [socket]);\n\n  const currentShipRef = React.useRef();\n  const grabXRef = React.useRef();\n  const grabYRef = React.useRef();\n\n  const [ships, setShips] = React.useState({\n    ship4: {\n      orientation: \"horizontal\",\n      size: 4,\n      reference: React.useRef(),\n      position: { x: 10, y: 320 },\n      neighbors: [],\n      map: [],\n      isPlaced: false,\n    },\n    ship3_1: {\n      orientation: \"horizontal\",\n      size: 3,\n      reference: React.useRef(),\n      position: { x: 140, y: 320 },\n      neighbors: [],\n      map: [],\n      isPlaced: false,\n    },\n    ship3_2: {\n      orientation: \"horizontal\",\n      size: 3,\n      reference: React.useRef(),\n      position: { x: 140, y: 420 },\n      neighbors: [],\n      map: [],\n      isPlaced: false,\n    },\n    ship2_1: {\n      orientation: \"horizontal\",\n      size: 2,\n      reference: React.useRef(),\n      position: { x: 240, y: 320 },\n      neighbors: [],\n      map: [],\n      isPlaced: false,\n    },\n    ship2_2: {\n      orientation: \"horizontal\",\n      size: 2,\n      reference: React.useRef(),\n      position: { x: 240, y: 390 },\n      neighbors: [],\n      map: [],\n      isPlaced: false,\n    },\n    ship2_3: {\n      orientation: \"horizontal\",\n      size: 2,\n      reference: React.useRef(),\n      position: { x: 240, y: 460 },\n      neighbors: [],\n      map: [],\n      isPlaced: false,\n    },\n    ship1_1: {\n      orientation: \"horizontal\",\n      size: 1,\n      reference: React.useRef(),\n      position: { x: 10, y: 450 },\n      neighbors: [],\n      map: [],\n      isPlaced: false,\n    },\n    ship1_2: {\n      orientation: \"horizontal\",\n      size: 1,\n      reference: React.useRef(),\n      position: { x: 50, y: 450 },\n      neighbors: [],\n      map: [],\n      isPlaced: false,\n    },\n    ship1_3: {\n      orientation: \"horizontal\",\n      size: 1,\n      reference: React.useRef(),\n      position: { x: 90, y: 450 },\n      neighbors: [],\n      map: [],\n      isPlaced: false,\n    },\n    ship1_4: {\n      orientation: \"horizontal\",\n      size: 1,\n      reference: React.useRef(),\n      position: { x: 10, y: 490 },\n      neighbors: [],\n      map: [],\n      isPlaced: false,\n    },\n  });\n\n  function generateGridDivsEnemy() {\n    const gridDivs = [];\n    grid.forEach((row, i) => {\n      row.forEach((col, j) => {\n        gridDivs.push(\n          <div\n            ref={enemyGridRefs[i][j]}\n            className=\"spot\"\n            style={{\n              backgroundColor: \"white\",\n              height: `${gridSize - 2}px`,\n              width: `${gridSize - 2}px`,\n              border: \"solid 1px black\",\n            }}\n            onDragStart={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              return false;\n            }}\n            onClick={async () => {\n              setTurn(false);\n              const data = {\n                roomID,\n                row: i,\n                col: j,\n              };\n              await socket.emit(\"hit\", data);\n              await socket.emit(\"change_turn\", true);\n            }}\n            key={`${i}-${j}`}\n          >\n            {gridContentEnemyState[i][j]}\n          </div>\n        );\n      });\n    });\n    return gridDivs;\n  }\n\n  function generateShipDivsAlly() {\n    const shipDivs = [];\n    for (const ship in ships) {\n      shipDivs.push(\n        <div\n          ref={ships[ship].reference}\n          key={ship}\n          draggable\n          onDragEnd={(e) =>\n            (ships[ship].reference.current.style.display = \"inline\")\n          }\n          onDragStart={(e) => {\n            setTimeout(\n              () => (ships[ship].reference.current.style.display = \"none\")\n            );\n            currentShipRef.current = ship;\n            const diffX = e.clientX - ships[ship].position.x;\n            const diffY = e.clientY - ships[ship].position.y;\n            grabXRef.current = parseInt(diffX / gridSize);\n            grabYRef.current = parseInt(diffY / gridSize);\n          }}\n          onMouseUp={(e) => setTimeout(handleMouseClick, 0, e, ship)}\n          onContextMenu={(e) => e.preventDefault()}\n          style={{\n            position: \"absolute\",\n            left: ships[ship].position.x,\n            top: ships[ship].position.y,\n            width: (() => {\n              switch (ships[ship].orientation) {\n                case \"horizontal\":\n                  return `${gridSize * ships[ship].size - 4}px`;\n                case \"vertical\":\n                  return gridSize - 4;\n                default:\n                  return \"100px\";\n              }\n            })(),\n            height: (() => {\n              switch (ships[ship].orientation) {\n                case \"horizontal\":\n                  return gridSize - 4;\n                case \"vertical\":\n                  return `${gridSize * ships[ship].size - 4}px`;\n                default:\n                  return \"100px\";\n              }\n            })(),\n            border: \"solid 2px blue\",\n            cursor: \"grab\",\n          }}\n        ></div>\n      );\n    }\n    return shipDivs;\n  }\n\n  function generateGridDivsAlly() {\n    const gridDivs = [];\n    grid.forEach((row, i) => {\n      row.forEach((col, j) => {\n        gridDivs.push(\n          <div\n            ref={allyGridRefs[i][j]}\n            className=\"spot\"\n            style={{\n              backgroundColor: \"white\",\n              height: `${gridSize - 2}px`,\n              width: `${gridSize - 2}px`,\n              border: \"solid 1px black\",\n            }}\n            key={`${i}-${j}`}\n            onDragStart={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              return false;\n            }}\n            onDragOver={(e) => {\n              e.preventDefault();\n              return false;\n            }}\n            onDrop={(e) => handleDrop(e, i, j)}\n          >\n            {gridContentState[i][j]}\n          </div>\n        );\n      });\n    });\n    return gridDivs;\n  }\n\n  function handleMouseClick(e, shipName) {\n    if (e.button !== 2) return;\n\n    const shipObj = ships[shipName];\n    const shipMap = shipObj.map;\n    const shipObjRefCurrent = shipObj.reference.current;\n\n    let shipsCopy = Object.assign({}, ships);\n\n    if (shipObj.isPlaced) {\n      var row = shipMap[0][0];\n      var col = shipMap[0][1];\n\n      switch (shipObj.orientation) {\n        case \"vertical\":\n          if (col > 10 - shipObj.size) return errorHandle(shipObjRefCurrent);\n          break;\n        case \"horizontal\":\n          if (row > 10 - shipObj.size) return errorHandle(shipObjRefCurrent);\n          break;\n        default:\n          console.warn(\"wrong ship orientation in start rmb handler\");\n      }\n    }\n\n    let allNeighborsExceptCurrentShip = [];\n    for (const ship in ships) {\n      if (ship !== shipName) {\n        ships[ship].neighbors.forEach((neighborPair) =>\n          allNeighborsExceptCurrentShip.push(neighborPair)\n        );\n      }\n    }\n\n    let newMap = [];\n\n    switch (shipObj.orientation) {\n      case \"horizontal\":\n        for (let i = 0; i < shipObj.size; i++) {\n          if (\n            multidimensionalIncludes(allNeighborsExceptCurrentShip, [\n              row + i,\n              col,\n            ])\n          )\n            return errorHandle(shipObjRefCurrent);\n          newMap.push([row + i, col]);\n        }\n\n        shipsCopy[shipName].orientation = \"vertical\";\n        break;\n\n      case \"vertical\":\n        for (let i = 0; i < shipObj.size; i++) {\n          if (\n            multidimensionalIncludes(allNeighborsExceptCurrentShip, [\n              row,\n              col + i,\n            ])\n          )\n            return errorHandle(shipObjRefCurrent);\n          newMap.push([row, col + i]);\n        }\n\n        shipsCopy[shipName].orientation = \"horizontal\";\n        break;\n\n      default:\n        console.warn(\"wrong ship orientation in rmb\");\n    }\n\n    shipsCopy[shipName].map = newMap;\n\n    let newNeighbors = [];\n\n    newMap.forEach((coords) => {\n      neighborsMoves.forEach((move) => {\n        const neighborsRow = coords[0] + move[0];\n        const neighborsCol = coords[1] + move[1];\n        const neighborsArray = [neighborsRow, neighborsCol];\n        if (\n          neighborsRow >= 0 &&\n          neighborsRow <= 9 &&\n          neighborsCol >= 0 &&\n          neighborsCol <= 9\n        )\n          if (\n            !multidimensionalIncludes(newNeighbors, neighborsArray) &&\n            !multidimensionalIncludes(newMap, neighborsArray)\n          )\n            newNeighbors.push(neighborsArray);\n      });\n    });\n    shipsCopy[shipName].neighbors = newNeighbors;\n\n    setShips(shipsCopy);\n  }\n\n  function handleDrop(e, dropRow, dropCol) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    const currentShipName = currentShipRef.current;\n    const shipObj = ships[currentShipName];\n    const shipsObjRefCurrent = shipObj.reference.current;\n\n    const grabX = grabXRef.current;\n    const grabY = grabYRef.current;\n\n    const placeX = dropCol * gridSize - grabX * gridSize + 8;\n    const placeY = dropRow * gridSize - grabY * gridSize + 8;\n\n    const placeCol = Math.floor(placeX / gridSize);\n    const placeRow = Math.floor(placeY / gridSize);\n\n    switch (shipObj.orientation) {\n      case \"horizontal\":\n        if (placeCol > 10 - shipObj.size || placeCol < 0)\n          return errorHandle(shipsObjRefCurrent);\n        break;\n\n      case \"vertical\":\n        if (placeRow > 10 - shipObj.size || placeRow < 0)\n          return errorHandle(shipsObjRefCurrent);\n        break;\n\n      default:\n        return console.warn(\n          \"ship have wrong orientation in dropHandle misplace check\"\n        );\n    }\n\n    let shipsCopy = Object.assign({}, ships);\n\n    let newMap = [];\n    let newNeighbors = [];\n\n    switch (shipObj.orientation) {\n      case \"vertical\":\n        for (let i = 0; i < shipObj.size; i++) {\n          const row = placeRow + i;\n          const col = placeCol;\n          const newMapPair = [row, col];\n          for (const shipName in ships) {\n            if (shipName !== currentShipName) {\n              if (\n                multidimensionalIncludes(\n                  shipsCopy[shipName].neighbors,\n                  newMapPair\n                )\n              )\n                return errorHandle(shipsObjRefCurrent);\n            }\n          }\n          newMap.push(newMapPair);\n        }\n        break;\n      case \"horizontal\":\n        for (let i = 0; i < shipObj.size; i++) {\n          const row = placeRow;\n          const col = placeCol + i;\n          const newMapPair = [row, col];\n          for (const shipName in ships) {\n            if (shipName !== currentShipName) {\n              if (\n                multidimensionalIncludes(\n                  shipsCopy[shipName].neighbors,\n                  newMapPair\n                )\n              )\n                return errorHandle(shipsObjRefCurrent);\n            }\n          }\n          newMap.push(newMapPair);\n        }\n        break;\n      default:\n        return console.warn(\n          \"ship have wrong orientation in dropHandle, newMap loop\"\n        );\n    }\n    shipsCopy[currentShipName].map = newMap;\n\n    // calculate new neighbors\n    newMap.forEach((coords) => {\n      neighborsMoves.forEach((move) => {\n        const neighborsRow = coords[0] + move[0];\n        const neighborsCol = coords[1] + move[1];\n        const neighborsArray = [neighborsRow, neighborsCol];\n        if (\n          neighborsRow >= 0 &&\n          neighborsRow <= 9 &&\n          neighborsCol >= 0 &&\n          neighborsCol <= 9\n        )\n          if (\n            !multidimensionalIncludes(newNeighbors, neighborsArray) &&\n            !multidimensionalIncludes(newMap, neighborsArray)\n          )\n            newNeighbors.push(neighborsArray);\n      });\n    });\n    shipsCopy[currentShipName].neighbors = newNeighbors;\n\n    shipsCopy[currentShipName].position.x = placeX;\n    shipsCopy[currentShipName].position.y = placeY;\n\n    shipsCopy[currentShipName].isPlaced = true;\n    setShips(shipsCopy);\n\n    return false;\n  }\n\n  return (\n    <div className=\"App\">\n      {!showField ? (\n        <>\n          <input\n            type=\"text\"\n            placeholder=\"Name...\"\n            onChange={(e) => setUsername(e.target.value)}\n          />\n          <input\n            type=\"text\"\n            placeholder=\"Room ID...\"\n            onChange={(e) => setRoomID(e.target.value)}\n          />\n          <button onClick={joinRoom}>Join room</button>\n        </>\n      ) : (\n        <div\n          className=\"Grids\"\n          style={{\n            display: \"grid\",\n            gridTemplateColumns: `repeat(2,${gridSize * 10}px)`,\n            gridTemplateRows: \"repeat(2,auto)\",\n            gap: \"50px\",\n          }}\n        >\n          <div\n            className=\"AllyGrid\"\n            style={{\n              textAlign: \"center\",\n              display: \"grid\",\n              lineHeight: \"25px\",\n              width: `${gridSize * 10}px`,\n              gridTemplateColumns: `repeat(10,${gridSize}px)`,\n              gridTemplateRows: `repeat(10,${gridSize}px)`,\n            }}\n          >\n            {generateGridDivsAlly()}\n          </div>\n          {generateShipDivsAlly()}\n          <div\n            className=\"EnemyGrid\"\n            style={{\n              display: \"grid\",\n              textAlign: \"center\",\n              lineHeight: \"25px\",\n              width: `${gridSize * 10}px`,\n              gridTemplateColumns: `repeat(10,${gridSize}px)`,\n              gridTemplateRows: `repeat(10,${gridSize}px)`,\n            }}\n          >\n            {generateGridDivsEnemy()}\n          </div>\n          {fieldReady ? (\n            <div\n              className=\"draggablePrevention\"\n              style={{\n                position: \"absolute\",\n                width: \"300px\",\n                height: \"300px\",\n                left: \"8px\",\n                top: \"8px\",\n                opacity: \"1\",\n              }}\n            ></div>\n          ) : (\n            <div\n              className=\"earlyHitPrevention\"\n              style={{\n                position: \"absolute\",\n                width: \"300px\",\n                height: \"300px\",\n                left: \"358px\",\n                top: \"8px\",\n                opacity: \"1\",\n              }}\n            ></div>\n          )}\n          <button\n            style={{ position: \"absolute\", right: 0 }}\n            onClick={() => {\n              for (const shipName in ships) {\n                if (!ships[shipName].isPlaced) {\n                  alert(\"not all ships placed\");\n                  return;\n                }\n              }\n              for (const shipName in ships) {\n                ships[shipName].map.forEach((coords) => {\n                  grid[coords[0]][coords[1]] = 1;\n                });\n              }\n              alert(\"field is ready for game!\");\n              setFieldReady(true);\n              socket.emit(\"field_ready\", true);\n            }}\n          >\n            Ready\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\n// .App {\n//   font-family: sans-serif;\n//   text-align: center;\n// }\n\n// .div {\n//   position: relative;\n// }\n\n// .div::after {\n//\n// .App {\n//   font-family: sans-serif;\n//   text-align: center;\n// }\n\n// .div {\n//   position: relative;\n// }\n",{"ruleId":"17","severity":1,"message":"18","line":54,"column":10,"nodeType":"19","messageId":"20","endLine":54,"endColumn":20},{"ruleId":"17","severity":1,"message":"21","line":54,"column":22,"nodeType":"19","messageId":"20","endLine":54,"endColumn":35},{"ruleId":"17","severity":1,"message":"22","line":58,"column":10,"nodeType":"19","messageId":"20","endLine":58,"endColumn":14},{"ruleId":"23","severity":1,"message":"24","line":125,"column":6,"nodeType":"25","endLine":125,"endColumn":14,"suggestions":"26"},"no-unused-vars","'hitCounter' is assigned a value but never used.","Identifier","unusedVar","'setHitCounter' is assigned a value but never used.","'turn' is assigned a value but never used.","react-hooks/exhaustive-deps","React Hook React.useEffect has an unnecessary dependency: 'socket'. Either exclude it or remove the dependency array. Outer scope values like 'socket' aren't valid dependencies because mutating them doesn't re-render the component.","ArrayExpression",["27"],{"desc":"28","fix":"29"},"Update the dependencies array to be: []",{"range":"30","text":"31"},[3611,3619],"[]"]